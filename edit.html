<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Platformer Level Editor</title>
<style>
  body { margin: 0; display: flex; font-family: sans-serif; }
  #editor { border: 1px solid black; background: #87CEEB; cursor: crosshair; }
  #tilePalette { margin-left: 20px; }
  .tile { width: 40px; height: 40px; display: inline-block; margin: 2px; cursor: pointer; border: 1px solid #333; }
  button, input { margin-top: 10px; display: block; padding: 5px; cursor: pointer; }
  h3 { margin-top: 0; }
  label { display: block; margin-top: 10px; }
</style>
</head>
<body>

<canvas id="editor"></canvas>

<div id="tilePalette">
  <h3>Tile Palette</h3>
  <div id="tiles"></div>

  <label>Width: <input type="number" id="widthInput" min="5" max="100" value="20"></label>
  <label>Height: <input type="number" id="heightInput" min="5" max="100" value="12"></label>
  <button id="resizeBtn">Resize Map</button>

  <button id="copyBtn">Copy Level Array</button>
  <p>Click a tile to select, then click/drag on the grid to draw. Clipboard copies 2D array directly!</p>
</div>

<script>
const canvas = document.getElementById("editor");
const ctx = canvas.getContext("2d");
const TILE_SIZE = 40;

let ROWS = 12;
let COLS = 20;
canvas.width = COLS * TILE_SIZE;
canvas.height = ROWS * TILE_SIZE;

// Tile ID â†’ color
const TILE_TYPES = {
  0: "#87CEEB", // empty
  10: "#8B0000", // dark red
  11: "#000000", // black
  12: "#8B4513", // brown
  13: "#008000", // green
  20: "#FF4500", // lava
  21: "#1E90FF", // water
  22: "#808080"  // spikes
};

let currentTile = 10;
let level = Array.from({length: ROWS}, () => Array(COLS).fill(0));
let drawing = false;

// --- Draw the grid ---
function drawGrid() {
  for (let y = 0; y < ROWS; y++) {
    for (let x = 0; x < COLS; x++) {
      ctx.fillStyle = TILE_TYPES[level[y][x]];
      ctx.fillRect(x*TILE_SIZE, y*TILE_SIZE, TILE_SIZE, TILE_SIZE);
      ctx.strokeStyle = "#333";
      ctx.strokeRect(x*TILE_SIZE, y*TILE_SIZE, TILE_SIZE, TILE_SIZE);
    }
  }
}
drawGrid();

// --- Place tile ---
function placeTile(x, y) {
  if (x >= 0 && x < COLS && y >= 0 && y < ROWS) {
    level[y][x] = currentTile;
    drawGrid();
  }
}

// --- Mouse events ---
canvas.addEventListener("mousedown", e => {
  drawing = true;
  const rect = canvas.getBoundingClientRect();
  const x = Math.floor((e.clientX - rect.left)/TILE_SIZE);
  const y = Math.floor((e.clientY - rect.top)/TILE_SIZE);
  placeTile(x, y);
});

canvas.addEventListener("mousemove", e => {
  if (!drawing) return;
  const rect = canvas.getBoundingClientRect();
  const x = Math.floor((e.clientX - rect.left)/TILE_SIZE);
  const y = Math.floor((e.clientY - rect.top)/TILE_SIZE);
  placeTile(x, y);
});

canvas.addEventListener("mouseup", () => drawing = false);
canvas.addEventListener("mouseleave", () => drawing = false);

// --- Tile palette ---
const tilesDiv = document.getElementById("tiles");
for (let key in TILE_TYPES) {
  const div = document.createElement("div");
  div.classList.add("tile");
  div.style.backgroundColor = TILE_TYPES[key];
  div.title = `Tile ${key}`;
  div.addEventListener("click", () => currentTile = parseInt(key));
  tilesDiv.appendChild(div);
}

// --- Copy to clipboard ---
document.getElementById("copyBtn").addEventListener("click", async () => {
  const arrayText = JSON.stringify(level, null, 2);
  try {
    await navigator.clipboard.writeText(arrayText);
    alert("Level array copied to clipboard!");
  } catch(e) {
    alert("Failed to copy. Open in secure context (https or localhost).");
  }
});

// --- Resize map ---
document.getElementById("resizeBtn").addEventListener("click", () => {
  const newWidth = parseInt(document.getElementById("widthInput").value);
  const newHeight = parseInt(document.getElementById("heightInput").value);

  const newLevel = Array.from({length: newHeight}, (_, y) =>
    Array.from({length: newWidth}, (_, x) => (level[y] && level[y][x]) || 0)
  );

  ROWS = newHeight;
  COLS = newWidth;
  level = newLevel;

  canvas.width = COLS * TILE_SIZE;
  canvas.height = ROWS * TILE_SIZE;
  drawGrid();
});
</script>

</body>
</html>
